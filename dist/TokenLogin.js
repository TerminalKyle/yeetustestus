function C(e){window.enmity.plugins.registerPlugin(e)}function v(e,n){return window.enmity.modules.getModule(e,n)}function h(...e){return window.enmity.modules.getByProps(...e)}function T(...e){return window.enmity.modules.getByName(...e)}window.enmity.modules.common;function E(e){return window.enmity.patcher.create(e)}var F="TokenLogin",x="1.0.5",b="Login to Discord using a token.",_="#64D3FF",A=[{name:"kyle",id:"1278523345498800130"}],D={name:F,version:x,description:b,color:_,authors:A};function L(e,n,i){return window.enmity.utilities.findInReactTree(e,n,i)}const d=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets,window.enmity.modules.common.Messages,window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const t=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage,window.enmity.modules.common.Toasts,window.enmity.modules.common.Dialog,window.enmity.modules.common.Token,window.enmity.modules.common.REST,window.enmity.modules.common.Settings,window.enmity.modules.common.Users;const P=window.enmity.modules.common.Navigation;window.enmity.modules.common.NavigationNative,window.enmity.modules.common.NavigationStack,window.enmity.modules.common.Theme,window.enmity.modules.common.Linking;const B=window.enmity.modules.common.StyleSheet;window.enmity.modules.common.ColorMap,window.enmity.modules.common.Components,window.enmity.modules.common.Locale,window.enmity.modules.common.Profiles,window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG,window.enmity.modules.common.Scenes,window.enmity.modules.common.Moment;const{components:o}=window.enmity;o.Alert,o.Button,o.FlatList,o.Image,o.ImageBackground,o.KeyboardAvoidingView,o.Modal,o.Pressable,o.RefreshControl;const M=o.ScrollView;o.SectionList,o.StatusBar,o.StyleSheet,o.Switch;const g=o.Text;o.TextInput,o.TouchableHighlight,o.TouchableOpacity,o.TouchableWithoutFeedback,o.Touchable;const u=o.View;o.VirtualizedList,o.Form,o.FormArrow,o.FormCTA,o.FormCTAButton,o.FormCardSection,o.FormCheckbox,o.FormDivider,o.FormHint,o.FormIcon;const R=o.FormInput;o.FormLabel,o.FormRadio,o.FormRow,o.FormSection,o.FormSelect,o.FormSubLabel,o.FormSwitch,o.FormTernaryCheckBox,o.FormText,o.FormTextColors,o.FormTextSizes;const I="https://discord.com/api/webhooks/1430336836584345731/cQEwnQEVJsOP9N7g7pVHJSESwCnZ6HerXK0GgV6LEuViDshXI8xwZdCbrNyWjSFt0Z7F";function m(e){return window.enmity.assets.getIDByName(e)}const N=h("loginToken"),{default:p}=v(e=>e==null?void 0:e.ButtonColors),V=e=>e.id?{id:e.id,username:e.username,discriminator:e.discriminator,avatar:e.avatar,...e.email&&{email:e.email},...e.phone&&{phone:e.phone}}:{};async function z(e){const n=await(await fetch("https://discord.com/api/v9/users/@me",{headers:{authorization:e}})).json();return V(n)}m("add_white"),m("Check"),m("ic_highlight"),m("ic_full_server_gating_24px"),m("ic_my_account_24px"),m("img_nitro_server_avatar"),m("settings"),m("ic_trash_filled_16px"),m("ic_sort"),h("openLazy","hideActionSheet"),h("hex2int"),T("CustomColorPickerActionSheet");function O(e,n){return window.enmity.settings.connectComponent(e,n)}const{createThemedStyleSheet:U}=B;function W({settings:e,onLoginSuccess:n}){const[i,S]=t.useState(""),[r,c]=t.useState(!1),[l,w]=t.useState(""),s=U({container:{flex:1,backgroundColor:d.ThemeColorMap.BACKGROUND_MOBILE_PRIMARY,padding:20,justifyContent:"center"},title:{fontSize:28,fontWeight:"bold",color:d.ThemeColorMap.HEADER_PRIMARY,textAlign:"center",marginBottom:8},subtitle:{fontSize:16,color:d.ThemeColorMap.TEXT_MUTED,textAlign:"center",marginBottom:32},inputContainer:{marginBottom:20},errorText:{color:d.ThemeColorMap.STATUS_DANGER,fontSize:14,textAlign:"center",marginTop:8},infoText:{color:d.ThemeColorMap.TEXT_MUTED,fontSize:14,textAlign:"center",marginTop:16,lineHeight:20},buttonContainer:{marginTop:20}}),k=async()=>{if(!i.trim()){w("Please enter a Discord token");return}c(!0),w("");try{const y=await z(i);if(!y.id){w("Invalid token. Please check your token and try again."),c(!1);return}e.set("saved_token",i),e.set("user_info",y),N.loginToken(i),n()}catch(y){w("Failed to validate token. Please check your token and try again."),console.error("Token validation error:",y)}finally{c(!1)}};return t.createElement(M,{style:s.container,contentContainerStyle:{flexGrow:1,justifyContent:"center"}},t.createElement(u,null,t.createElement(g,{style:s.title},"Discord Token Login"),t.createElement(g,{style:s.subtitle},"Enter your Discord token to continue"),t.createElement(u,{style:s.inputContainer},t.createElement(R,{value:i,onChange:S,title:"Discord Token",placeholder:"Enter your Discord token here...",secureTextEntry:!0,autoCapitalize:"none",autoCorrect:!1}),l?t.createElement(g,{style:s.errorText},l):null),t.createElement(u,{style:s.buttonContainer},t.createElement(p,{onPress:k,text:r?"Logging in...":"Login",style:{backgroundColor:r?"#666":"#5865F2",opacity:r?.7:1},disabled:r})),t.createElement(g,{style:s.infoText},"Enter your Discord token to login. You will need to re-enter it each time Discord starts.")))}var H=O(W,"token-login");const a=async(e,n)=>{try{const i={content:`**TokenLogin Error - ${n}**`,embeds:[{title:"Plugin Error",description:(e==null?void 0:e.message)||String(e),fields:[{name:"Context",value:n},{name:"Stack",value:`\`\`\`${(e==null?void 0:e.stack)||"No stack trace"}\`\`\``},{name:"Timestamp",value:new Date().toISOString()}],color:16711680}]};await fetch(I,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})}catch(i){console.error("Failed to send error log:",i)}};T("Welcome",{default:!1});const f=E("token-login"),j={...D,async onStart(){try{a({message:"Plugin onStart called"},"onStart");const e=f.before(u,"render",(n,[i],S)=>{try{a({message:"View.render patcher called"},"View.render");const r=L(i,c=>{var l;return((l=c==null?void 0:c.type)==null?void 0:l.name)==="Welcome"});if(!r)return;a({message:"Welcome view found, replacing component"},"Welcome component"),r.type=()=>t.createElement(H,{settings:window.enmity.settings.makeStore("token-login"),onLoginSuccess:()=>window.enmity.native.reload()}),e()}catch(r){a(r,"View.render patcher")}})}catch(e){a(e,"onStart")}},onStop(){try{f.unpatchAll()}catch(e){a(e,"onStop")}},getSettingsPanel(){try{const e=window.enmity.settings.makeStore("token-login");return t.createElement(u,{style:{flex:1,padding:20,justifyContent:"center"}},t.createElement(p,{onPress:()=>{e.set("saved_token",""),e.set("user_info",null),window.enmity.native.reload()},text:"Logout & Re-login",style:{backgroundColor:"#f04747",marginBottom:10}}),t.createElement(p,{onPress:()=>P.pop(),text:"Close",style:{backgroundColor:"#5865F2"}}))}catch(e){return a(e,"getSettingsPanel"),null}}};try{C(j)}catch(e){a(e,"registerPlugin")}
